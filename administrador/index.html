<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <title>ğŸ² Panel de Administrador - Rifa Web</title>
    
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            emailjs.init("KFZ8WsN6aH69H3Gae");
            console.log('EmailJS inicializado en panel admin');
        })();
    </script>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">ğŸ² Panel de Administrador</h1>
            <p class="subtitle">GestiÃ³n completa de la rifa de dos cifras (00-99)</p>
            <div class="connection-status" id="connectionStatus">
                <span class="status-indicator offline"></span>
                <span class="status-text">Conectando...</span>
            </div>
        </header>

        <main class="main-content">
            <!-- Dashboard Principal -->
            <div class="dashboard-section">
                <h2>ğŸ“Š Control General</h2>
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-icon">ğŸ‘¥</div>
                        <div class="card-content">
                            <div class="card-value" id="totalParticipants">0</div>
                            <div class="card-label">Total Participantes</div>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon">ğŸ¯</div>
                        <div class="card-content">
                            <div class="card-value" id="occupiedSlots">0</div>
                            <div class="card-label">Ocupados</div>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon">ğŸ“§</div>
                        <div class="card-content">
                            <div class="card-value" id="availableSlots">100</div>
                            <div class="card-label">Disponibles</div>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon">ğŸ“ˆ</div>
                        <div class="card-content">
                            <div class="card-value" id="occupationPercentage">0%</div>
                            <div class="card-label">Porcentaje OcupaciÃ³n</div>
                        </div>
                    </div>
                </div>
                <!-- Barra de Progreso -->
                <div class="progress-section">
                    <div class="progress-info">
                        <span>Progreso de ocupaciÃ³n</span>
                        <span id="progressText">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar"></div>
                    </div>
                </div>
            </div>

            <!-- ConfiguraciÃ³n de la Rifa -->
            <div class="rifa-config-section">
                <div class="section-header">
                    <h2>âš™ï¸ ConfiguraciÃ³n de la Rifa</h2>
                    <div class="header-actions">
                        <button class="save-config-btn" id="saveConfigBtn">ğŸ’¾ Guardar ConfiguraciÃ³n</button>
                        <button class="delete-config-btn" id="deleteConfigBtn">ğŸ—‘ï¸ Eliminar ConfiguraciÃ³n</button>
                    </div>
                </div>
                
                <div class="config-form">
                    <div class="config-grid">
                        <div class="config-item">
                            <label for="rifaTitle">Â¿QuÃ© estÃ¡s rifando?:</label>
                            <input type="text" id="rifaTitle" placeholder="Ej: iPhone 15, PlayStation 5, etc." maxlength="100">
                        </div>
                        <div class="config-item">
                            <label for="rifaAmount">Monto de la rifa (COP):</label>
                            <input type="text" id="rifaAmount" placeholder="10.000" pattern="[0-9,.]*">
                        </div>
                        <div class="config-item">
                            <label for="sorteoDate">Fecha del sorteo:</label>
                            <input type="date" id="sorteoDate">
                        </div>
                        <div class="config-item">
                            <label for="loteria">LoterÃ­a para el sorteo:</label>
                            <select id="loteria">
                                <option value="">Selecciona una loterÃ­a</option>
                                <option value="Baloto">Baloto</option>
                                <option value="LoterÃ­a de BogotÃ¡">LoterÃ­a de BogotÃ¡</option>
                                <option value="LoterÃ­a de MedellÃ­n">LoterÃ­a de MedellÃ­n</option>
                                <option value="LoterÃ­a de Cali">LoterÃ­a de Cali</option>
                                <option value="LoterÃ­a de Manizales">LoterÃ­a de Manizales</option>
                                <option value="LoterÃ­a de Bucaramanga">LoterÃ­a de Bucaramanga</option>
                                <option value="LoterÃ­a de Pereira">LoterÃ­a de Pereira</option>
                                <option value="LoterÃ­a de Cundinamarca">LoterÃ­a de Cundinamarca</option>
                                <option value="LoterÃ­a de BoyacÃ¡">LoterÃ­a de BoyacÃ¡</option>
                                <option value="LoterÃ­a de Santander">LoterÃ­a de Santander</option>
                                <option value="LoterÃ­a de Antioquia">LoterÃ­a de Antioquia</option>
                                <option value="LoterÃ­a de Valle">LoterÃ­a de Valle</option>
                                <option value="LoterÃ­a de Cauca">LoterÃ­a de Cauca</option>
                                <option value="LoterÃ­a de NariÃ±o">LoterÃ­a de NariÃ±o</option>
                                <option value="LoterÃ­a de AtlÃ¡ntico">LoterÃ­a de AtlÃ¡ntico</option>
                                <option value="LoterÃ­a de BolÃ­var">LoterÃ­a de BolÃ­var</option>
                                <option value="LoterÃ­a de Magdalena">LoterÃ­a de Magdalena</option>
                                <option value="LoterÃ­a de Cesar">LoterÃ­a de Cesar</option>
                                <option value="LoterÃ­a de La Guajira">LoterÃ­a de La Guajira</option>
                                <option value="LoterÃ­a de Norte de Santander">LoterÃ­a de Norte de Santander</option>
                                <option value="LoterÃ­a de Arauca">LoterÃ­a de Arauca</option>
                                <option value="LoterÃ­a de Casanare">LoterÃ­a de Casanare</option>
                                <option value="LoterÃ­a de Meta">LoterÃ­a de Meta</option>
                                <option value="LoterÃ­a de Vichada">LoterÃ­a de Vichada</option>
                                <option value="LoterÃ­a de GuainÃ­a">LoterÃ­a de GuainÃ­a</option>
                                <option value="LoterÃ­a de VaupÃ©s">LoterÃ­a de VaupÃ©s</option>
                                <option value="LoterÃ­a de Amazonas">LoterÃ­a de Amazonas</option>
                                <option value="LoterÃ­a de Putumayo">LoterÃ­a de Putumayo</option>
                                <option value="LoterÃ­a de CaquetÃ¡">LoterÃ­a de CaquetÃ¡</option>
                                <option value="LoterÃ­a de Huila">LoterÃ­a de Huila</option>
                                <option value="LoterÃ­a de Tolima">LoterÃ­a de Tolima</option>
                                <option value="LoterÃ­a de QuindÃ­o">LoterÃ­a de QuindÃ­o</option>
                                <option value="LoterÃ­a de Risaralda">LoterÃ­a de Risaralda</option>
                                <option value="LoterÃ­a de ChocÃ³">LoterÃ­a de ChocÃ³</option>
                                <option value="LoterÃ­a de San AndrÃ©s">LoterÃ­a de San AndrÃ©s</option>
                                <option value="Otro">Otro (especificar)</option>
                            </select>
                        </div>
                        <div class="config-item" id="otraLoteriaContainer" style="display: none;">
                            <label for="otraLoteria">Especificar otra loterÃ­a:</label>
                            <input type="text" id="otraLoteria" placeholder="Nombre de la loterÃ­a" maxlength="50">
                        </div>
                        <div class="config-item">
                            <label for="nequiNumber">NÃºmero Nequi:</label>
                            <input type="text" id="nequiNumber" placeholder="3001234567">
                        </div>
                        <div class="config-item">
                            <label for="rifaStatus">Estado de la rifa:</label>
                            <select id="rifaStatus">
                                <option value="true">Activa</option>
                                <option value="false">Inactiva</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ConfiguraciÃ³n de Mensajes WhatsApp -->
            <div class="whatsapp-config-section">
                <div class="section-header">
                    <h2>ğŸ“± ConfiguraciÃ³n de Mensajes WhatsApp</h2>
                    <div class="header-actions">
                        <button class="save-config-btn" id="saveWhatsAppConfigBtn">ğŸ’¾ Guardar Mensajes</button>
                        <button class="sync-btn" id="syncWhatsAppBtn">ğŸ”„ Sincronizar</button>
                        <button class="test-btn" id="testWhatsAppBtn">ğŸ§ª Probar Mensajes</button>
                    </div>
                </div>
                
                <div class="config-form">
                    <div class="config-grid">
                        <div class="config-item full-width">
                            <label for="reminderMessage">Mensaje de Recordatorio:</label>
                            <textarea id="reminderMessage" rows="4" placeholder="Mensaje para recordar pagos pendientes...">ğŸ”” RECORDATORIO DE PAGO

Tienes pendiente el pago de la cuota {nextInstallment}/{totalInstallments}.

ğŸ“Š Estado de tu plan:
â€¢ Plan: {planType}
â€¢ Cuota actual: {currentInstallment}/{totalInstallments}
â€¢ Monto por cuota: {installmentAmount} COP
â€¢ Restante por pagar: {remainingAmount} COP

ğŸ’³ NÃºmero Nequi: {nequiNumber}
ğŸ“± Por favor, realiza el pago y envÃ­a el comprobante.

Â¡Gracias por tu participaciÃ³n! ğŸ²</textarea>
                        </div>
                        <div class="config-item full-width">
                            <label for="confirmationMessage">Mensaje de ConfirmaciÃ³n:</label>
                            <textarea id="confirmationMessage" rows="4" placeholder="Mensaje para confirmar pagos recibidos...">âœ… CONFIRMACIÃ“N DE PAGO

Hemos recibido y verificado tu pago correctamente.

ğŸ“Š InformaciÃ³n de tu participaciÃ³n:
â€¢ NÃºmero asignado: {participantNumber}
â€¢ Plan: {planType}
â€¢ Monto pagado: {totalAmount} COP

ğŸ² Tu participaciÃ³n estÃ¡ confirmada para el sorteo.
Â¡Mucha suerte! ğŸ€</textarea>
                        </div>
                        <div class="config-item full-width">
                            <label for="winnerMessage">Mensaje de Ganador:</label>
                            <textarea id="winnerMessage" rows="4" placeholder="Mensaje para notificar al ganador...">ğŸ‰ Â¡FELICIDADES {participantName}! ğŸ‰

ğŸ† Â¡ERES EL GANADOR DE LA RIFA! ğŸ†

Tu nÃºmero {participantNumber} ha sido seleccionado como ganador.

ğŸ“ Te contactaremos pronto para coordinar la entrega del premio.

Â¡Felicidades! ğŸŠğŸŠğŸŠ</textarea>
                        </div>
                        <div class="config-item">
                            <label for="autoNotifications">Notificaciones AutomÃ¡ticas:</label>
                            <select id="autoNotifications">
                                <option value="true">Activadas</option>
                                <option value="false">Desactivadas</option>
                            </select>
                        </div>
                        <div class="config-item">
                            <label for="autoReminders">Recordatorios AutomÃ¡ticos:</label>
                            <select id="autoReminders">
                                <option value="false">Desactivados</option>
                                <option value="true">Activados</option>
                            </select>
                        </div>
                        <div class="config-item">
                            <label for="reminderDays">DÃ­as antes del vencimiento:</label>
                            <input type="number" id="reminderDays" min="1" max="30" value="3">
                        </div>
                    </div>
                </div>
            </div>

            <!-- GestiÃ³n de Participantes -->
            <div class="participants-management">
                <div class="section-header">
                    <h2>ğŸ‘¥ GestiÃ³n de Participantes</h2>
                    <div class="header-actions">
                        <button class="export-btn" id="exportBtn">ğŸ“„ Exportar PDF</button>
                        <button class="clear-btn" id="clearAllBtn">ğŸ—‘ï¸ Limpiar Todo</button>
                    </div>
                </div>

                <!-- BÃºsqueda y Ordenamiento -->
                <div class="search-section">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="ğŸ” Buscar por nombre, email o nÃºmero...">
                        <button class="clear-search-btn" id="clearSearchBtn" title="Limpiar bÃºsqueda">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="sort-section">
                        <label for="sortSelect">Ordenar por:</label>
                        <select id="sortSelect" class="sort-select">
                            <option value="date-desc" selected>Fecha (mÃ¡s reciente)</option>
                            <option value="date-asc">Fecha (mÃ¡s antigua)</option>
                            <option value="name-asc">Nombre (A-Z)</option>
                            <option value="name-desc">Nombre (Z-A)</option>
                            <option value="city-asc">Ciudad (A-Z)</option>
                            <option value="city-desc">Ciudad (Z-A)</option>
                            <option value="number-asc">NÃºmero (0-99)</option>
                            <option value="number-desc">NÃºmero (99-0)</option>
                        </select>
                    </div>
                </div>

                <!-- Lista de Participantes -->
                <div class="participants-grid" id="participantsList">
                    <!-- Los participantes se cargarÃ¡n dinÃ¡micamente aquÃ­ -->
                    <!-- Ejemplo de tarjeta de participante con botÃ³n de abono -->
                    <!--
                    <div class="participant-card">
                        <div class="participant-info">
                            <span class="participant-name">Nombre Apellido</span>
                            <span class="participant-number">#23</span>
                            <span class="participant-email">correo@ejemplo.com</span>
                        </div>
                        <div class="participant-actions">
                            <button class="abono-btn" title="Hacer abono">ğŸ’¸ Hacer abono</button>
                        </div>
                    </div>
                    -->
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>Â© 2025 Rifa Web - Panel de Administrador | Acceso restringido</p>
        </footer>
    </div>

    <!-- Modal de ConfirmaciÃ³n -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <h3 id="modalTitle">Confirmar AcciÃ³n</h3>
            <p id="modalMessage">Â¿EstÃ¡s seguro de que quieres realizar esta acciÃ³n?</p>
            <div class="modal-actions">
                <button class="cancel-btn" id="cancelBtn">Cancelar</button>
                <button class="confirm-btn" id="confirmBtn">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Modal de EdiciÃ³n -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <h3>âœï¸ Editar Participante</h3>
            <form id="editForm">
                <div class="form-group">
                    <label for="editName">Nombre:</label>
                    <input type="text" id="editName" required>
                </div>
                <div class="form-group">
                    <label for="editCity">Ciudad:</label>
                    <input type="text" id="editCity" required>
                </div>
                <div class="form-group">
                    <label for="editEmail">Email:</label>
                    <input type="email" id="editEmail" required>
                </div>
                <div class="form-group">
                    <label for="editPhone">TelÃ©fono:</label>
                    <input type="tel" id="editPhone" required>
                </div>
                <div class="form-group">
                    <label for="editNumber">NÃºmero:</label>
                    <input type="number" id="editNumber" min="0" max="99" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-btn" id="cancelEditBtn">Cancelar</button>
                    <button type="submit" class="save-btn">ğŸ’¾ Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module" src="../firebase-config.js"></script>
    <script type="module" src="../firebase-service.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <script src="script.js"></script>
</body>
</html> 