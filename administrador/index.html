<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <title>üé≤ Panel de Administrador - Rifa Web</title>
    
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            emailjs.init("KFZ8WsN6aH69H3Gae");
            console.log('EmailJS inicializado en panel admin');
        })();
    </script>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">üé≤ Panel de Administrador</h1>
            <p class="subtitle">Gesti√≥n completa de la rifa de dos cifras (00-99)</p>
            <div class="connection-status" id="connectionStatus">
                <span class="status-indicator offline"></span>
                <span class="status-text">Conectando...</span>
            </div>
        </header>

        <main class="main-content">
            <!-- Dashboard Principal -->
            <div class="dashboard-section">
                <h2>üìä Control General</h2>
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-icon">üë•</div>
                        <div class="card-content">
                            <div class="card-value" id="totalParticipants">0</div>
                            <div class="card-label">Total Participantes</div>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon">üéØ</div>
                        <div class="card-content">
                            <div class="card-value" id="occupiedSlots">0</div>
                            <div class="card-label">Ocupados</div>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon">üìß</div>
                        <div class="card-content">
                            <div class="card-value" id="availableSlots">100</div>
                            <div class="card-label">Disponibles</div>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon">üìà</div>
                        <div class="card-content">
                            <div class="card-value" id="occupationPercentage">0%</div>
                            <div class="card-label">Porcentaje Ocupaci√≥n</div>
                        </div>
                    </div>
                </div>
                <!-- Barra de Progreso -->
                <div class="progress-section">
                    <div class="progress-info">
                        <span>Progreso de ocupaci√≥n</span>
                        <span id="progressText">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar"></div>
                    </div>
                </div>
            </div>

            <!-- Configuraci√≥n de la Rifa -->
            <div class="rifa-config-section">
                <div class="section-header">
                    <h2>‚öôÔ∏è Configuraci√≥n de la Rifa</h2>
                    <div class="header-actions">
                        <button class="save-config-btn" id="saveConfigBtn">üíæ Guardar Configuraci√≥n</button>
                        <button class="delete-config-btn" id="deleteConfigBtn">üóëÔ∏è Eliminar Configuraci√≥n</button>
                    </div>
                </div>
                
                <div class="config-form">
                    <div class="config-grid">
                        <div class="config-item">
                            <label for="rifaTitle">¬øQu√© est√°s rifando?:</label>
                            <input type="text" id="rifaTitle" placeholder="Ej: iPhone 15, PlayStation 5, etc." maxlength="100">
                        </div>
                        <div class="config-item">
                            <label for="rifaAmount">Monto de la rifa (COP):</label>
                            <input type="text" id="rifaAmount" placeholder="10.000" pattern="[0-9,.]*">
                        </div>
                        <div class="config-item">
                            <label for="sorteoDate">Fecha del sorteo:</label>
                            <input type="date" id="sorteoDate">
                        </div>
                        <div class="config-item">
                            <label for="loteria">Loter√≠a para el sorteo:</label>
                            <select id="loteria">
                                <option value="">Selecciona una loter√≠a</option>
                                <option value="Baloto">Baloto</option>
                                <option value="Loter√≠a de Bogot√°">Loter√≠a de Bogot√°</option>
                                <option value="Loter√≠a de Medell√≠n">Loter√≠a de Medell√≠n</option>
                                <option value="Loter√≠a de Cali">Loter√≠a de Cali</option>
                                <option value="Loter√≠a de Manizales">Loter√≠a de Manizales</option>
                                <option value="Loter√≠a de Bucaramanga">Loter√≠a de Bucaramanga</option>
                                <option value="Loter√≠a de Pereira">Loter√≠a de Pereira</option>
                                <option value="Loter√≠a de Cundinamarca">Loter√≠a de Cundinamarca</option>
                                <option value="Loter√≠a de Boyac√°">Loter√≠a de Boyac√°</option>
                                <option value="Loter√≠a de Santander">Loter√≠a de Santander</option>
                                <option value="Loter√≠a de Antioquia">Loter√≠a de Antioquia</option>
                                <option value="Loter√≠a de Valle">Loter√≠a de Valle</option>
                                <option value="Loter√≠a de Cauca">Loter√≠a de Cauca</option>
                                <option value="Loter√≠a de Nari√±o">Loter√≠a de Nari√±o</option>
                                <option value="Loter√≠a de Atl√°ntico">Loter√≠a de Atl√°ntico</option>
                                <option value="Loter√≠a de Bol√≠var">Loter√≠a de Bol√≠var</option>
                                <option value="Loter√≠a de Magdalena">Loter√≠a de Magdalena</option>
                                <option value="Loter√≠a de Cesar">Loter√≠a de Cesar</option>
                                <option value="Loter√≠a de La Guajira">Loter√≠a de La Guajira</option>
                                <option value="Loter√≠a de Norte de Santander">Loter√≠a de Norte de Santander</option>
                                <option value="Loter√≠a de Arauca">Loter√≠a de Arauca</option>
                                <option value="Loter√≠a de Casanare">Loter√≠a de Casanare</option>
                                <option value="Loter√≠a de Meta">Loter√≠a de Meta</option>
                                <option value="Loter√≠a de Vichada">Loter√≠a de Vichada</option>
                                <option value="Loter√≠a de Guain√≠a">Loter√≠a de Guain√≠a</option>
                                <option value="Loter√≠a de Vaup√©s">Loter√≠a de Vaup√©s</option>
                                <option value="Loter√≠a de Amazonas">Loter√≠a de Amazonas</option>
                                <option value="Loter√≠a de Putumayo">Loter√≠a de Putumayo</option>
                                <option value="Loter√≠a de Caquet√°">Loter√≠a de Caquet√°</option>
                                <option value="Loter√≠a de Huila">Loter√≠a de Huila</option>
                                <option value="Loter√≠a de Tolima">Loter√≠a de Tolima</option>
                                <option value="Loter√≠a de Quind√≠o">Loter√≠a de Quind√≠o</option>
                                <option value="Loter√≠a de Risaralda">Loter√≠a de Risaralda</option>
                                <option value="Loter√≠a de Choc√≥">Loter√≠a de Choc√≥</option>
                                <option value="Loter√≠a de San Andr√©s">Loter√≠a de San Andr√©s</option>
                                <option value="Otro">Otro (especificar)</option>
                            </select>
                        </div>
                        <div class="config-item" id="otraLoteriaContainer" style="display: none;">
                            <label for="otraLoteria">Especificar otra loter√≠a:</label>
                            <input type="text" id="otraLoteria" placeholder="Nombre de la loter√≠a" maxlength="50">
                        </div>
                        <div class="config-item">
                            <label for="nequiNumber">N√∫mero Nequi:</label>
                            <input type="text" id="nequiNumber" placeholder="3001234567">
                        </div>
                        <div class="config-item">
                            <label for="rifaStatus">Estado de la rifa:</label>
                            <select id="rifaStatus">
                                <option value="true">Activa</option>
                                <option value="false">Inactiva</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuraci√≥n de Mensajes WhatsApp -->
            <div class="whatsapp-config-section">
                <div class="section-header">
                    <h2>üì± Configuraci√≥n de Mensajes WhatsApp</h2>
                    <div class="header-actions">
                        <button class="save-config-btn" id="saveWhatsAppConfigBtn">üíæ Guardar Mensajes</button>
                        <button class="sync-btn" id="syncWhatsAppBtn">üîÑ Sincronizar</button>
                        <button class="test-btn" id="testWhatsAppBtn">üß™ Probar Mensajes</button>
                    </div>
                </div>
                
                <div class="config-form">
                    <div class="config-grid">
                        <div class="config-item full-width">
                            <label for="reminderMessage">Mensaje de Recordatorio:</label>
                            <textarea id="reminderMessage" rows="4" placeholder="Mensaje para recordar pagos pendientes...">üîî RECORDATORIO DE PAGO

Tienes pendiente el pago de la cuota {nextInstallment}/{totalInstallments}.

üìä Estado de tu plan:
‚Ä¢ Plan: {planType}
‚Ä¢ Cuota actual: {currentInstallment}/{totalInstallments}
‚Ä¢ Monto por cuota: {installmentAmount} COP
‚Ä¢ Restante por pagar: {remainingAmount} COP

üí≥ N√∫mero Nequi: {nequiNumber}
üì± Por favor, realiza el pago y env√≠a el comprobante.

¬°Gracias por tu participaci√≥n! üé≤</textarea>
                        </div>
                        <div class="config-item full-width">
                            <label for="confirmationMessage">Mensaje de Confirmaci√≥n:</label>
                            <textarea id="confirmationMessage" rows="4" placeholder="Mensaje para confirmar pagos recibidos...">‚úÖ CONFIRMACI√ìN DE PAGO

Hemos recibido y verificado tu pago correctamente.

üìä Informaci√≥n de tu participaci√≥n:
‚Ä¢ N√∫mero asignado: {participantNumber}
‚Ä¢ Plan: {planType}
‚Ä¢ Monto pagado: {totalAmount} COP

üé≤ Tu participaci√≥n est√° confirmada para el sorteo.
¬°Mucha suerte! üçÄ</textarea>
                        </div>
                        <div class="config-item full-width">
                            <label for="winnerMessage">Mensaje de Ganador:</label>
                            <textarea id="winnerMessage" rows="4" placeholder="Mensaje para notificar al ganador...">üéâ ¬°FELICIDADES {participantName}! üéâ

üèÜ ¬°ERES EL GANADOR DE LA RIFA! üèÜ

Tu n√∫mero {participantNumber} ha sido seleccionado como ganador.

üìû Te contactaremos pronto para coordinar la entrega del premio.

¬°Felicidades! üéäüéäüéä</textarea>
                        </div>
                        <div class="config-item">
                            <label for="autoNotifications">Notificaciones Autom√°ticas:</label>
                            <select id="autoNotifications">
                                <option value="true">Activadas</option>
                                <option value="false">Desactivadas</option>
                            </select>
                        </div>
                        <div class="config-item">
                            <label for="autoReminders">Recordatorios Autom√°ticos:</label>
                            <select id="autoReminders">
                                <option value="false">Desactivados</option>
                                <option value="true">Activados</option>
                            </select>
                        </div>
                        <div class="config-item">
                            <label for="reminderDays">D√≠as antes del vencimiento:</label>
                            <input type="number" id="reminderDays" min="1" max="30" value="3">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gesti√≥n de Participantes -->
            <div class="participants-management">
                <div class="section-header">
                    <h2>üë• Gesti√≥n de Participantes</h2>
                    <div class="header-actions">
                        <button class="export-btn" id="exportBtn">üìÑ Exportar PDF</button>
                        <button class="clear-btn" id="clearAllBtn">üóëÔ∏è Limpiar Todo</button>
                    </div>
                </div>

                <!-- B√∫squeda y Ordenamiento -->
                <div class="search-section">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="üîç Buscar por nombre, email o n√∫mero...">
                        <button class="clear-search-btn" id="clearSearchBtn" title="Limpiar b√∫squeda">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="sort-section">
                        <label for="sortSelect">Ordenar por:</label>
                        <select id="sortSelect" class="sort-select">
                            <option value="date-desc" selected>Fecha (m√°s reciente)</option>
                            <option value="date-asc">Fecha (m√°s antigua)</option>
                            <option value="name-asc">Nombre (A-Z)</option>
                            <option value="name-desc">Nombre (Z-A)</option>
                            <option value="city-asc">Ciudad (A-Z)</option>
                            <option value="city-desc">Ciudad (Z-A)</option>
                            <option value="number-asc">N√∫mero (0-99)</option>
                            <option value="number-desc">N√∫mero (99-0)</option>
                        </select>
                    </div>
                </div>

                <!-- Lista de Participantes -->
                <div class="participants-grid" id="participantsList">
                    <!-- Los participantes se cargar√°n din√°micamente aqu√≠ -->
                    <!-- Ejemplo de tarjeta de participante con bot√≥n de abono -->
                    <!--
                    <div class="participant-card">
                        <div class="participant-info">
                            <span class="participant-name">Nombre Apellido</span>
                            <span class="participant-number">#23</span>
                            <span class="participant-email">correo@ejemplo.com</span>
                        </div>
                        <div class="participant-actions">
                            <button class="abono-btn" title="Hacer abono">üí∏ Hacer abono</button>
                        </div>
                    </div>
                    -->
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>¬© 2025 Rifa Web - Panel de Administrador | Acceso restringido</p>
        </footer>
    </div>

    <!-- Modal de Confirmaci√≥n -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <h3 id="modalTitle">Confirmar Acci√≥n</h3>
            <p id="modalMessage">¬øEst√°s seguro de que quieres realizar esta acci√≥n?</p>
            <div class="modal-actions">
                <button class="cancel-btn" id="cancelBtn">Cancelar</button>
                <button class="confirm-btn" id="confirmBtn">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Edici√≥n -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <h3>‚úèÔ∏è Editar Participante</h3>
            <form id="editForm">
                <div class="form-group">
                    <label for="editName">Nombre:</label>
                    <input type="text" id="editName" required>
                </div>
                <div class="form-group">
                    <label for="editCity">Ciudad:</label>
                    <input type="text" id="editCity" required>
                </div>
                <div class="form-group">
                    <label for="editEmail">Email:</label>
                    <input type="email" id="editEmail" required>
                </div>
                <div class="form-group">
                    <label for="editPhone">Tel√©fono:</label>
                    <input type="tel" id="editPhone" required>
                </div>
                <div class="form-group">
                    <label for="editNumber">N√∫mero:</label>
                    <input type="number" id="editNumber" min="0" max="99" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-btn" id="cancelEditBtn">Cancelar</button>
                    <button type="submit" class="save-btn">üíæ Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module" src="../firebase-config.js"></script>
    <script type="module" src="../firebase-service.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <script src="script.js"></script>
</body>
</html> 